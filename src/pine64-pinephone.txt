setenv kernel_addr_z 0x44080000

setenv bootargs loglevel=0 silent console=tty0 vt.global_cursor_default=0

gpio set 114

if test "${volume_key}" = "up" ; then 
if load ${devtype} ${devnum}:${distro_bootpart} ${kernel_addr_z} /Image.gz; then
  unzip ${kernel_addr_z} ${kernel_addr_r}
  if load ${devtype} ${devnum}:${distro_bootpart} ${fdt_addr_r} /sun50i-a64-pinephone-1.2.dtb; then
    if load ${devtype} ${devnum}:${distro_bootpart} ${ramdisk_addr_r} /initramfs.gz; then
      booti ${kernel_addr_r} ${ramdisk_addr_r}:${filesize} ${fdt_addr_r};
    else
      booti ${kernel_addr_r} - ${fdt_addr_r};
    fi;
  fi;
fi
else

setenv devtype mmc
# setenv devnum 1
setenv mmc_bootdev 1

gpio set 98
gpio set 114

echo "Booting from eMMC";
setenv bootdev 2;

# Set root partition to the second partition of boot device
# part uuid ${devtype} ${devnum}:1 uuid_boot
# part uuid ${devtype} ${devnum}:2 uuid_root

setenv bootargs loglevel=4 console=tty0 console=${console} earlycon=uart,mmio32,0x01c28000 consoleblank=0 boot=/dev/mmcblk${bootdev}p1 root=/dev/mmcblk${bootdev}p2 rw rootwait quiet audit=0 bootsplash.bootfile=bootsplash-themes/manjaro/bootsplash

printenv

if load ${devtype} ${mmc_bootdev}:${distro_bootpart} ${kernel_addr_r} /Image; then
  gpio clear 98
  if load ${devtype} ${mmc_bootdev}:${distro_bootpart} ${fdt_addr_r} /dtbs/allwinner/sun50i-a64-pinephone-1.2b.dtb; then
    if load ${devtype} ${mmc_bootdev}:${distro_bootpart} ${ramdisk_addr_r} /initramfs-linux.img; then
      gpio set 115
      booti ${kernel_addr_r} ${ramdisk_addr_r}:${filesize} ${fdt_addr_r};
    else
      gpio set 116
      booti ${kernel_addr_r} - ${fdt_addr_r};
    fi;
  fi;
fi

fi
